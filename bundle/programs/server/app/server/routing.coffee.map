{"version":3,"sources":["meteor://ðŸ’»app/server/routing.coffee"],"names":["fs","Npm","require","Router","map","route","path","where","action","basename","content","e","filename","stats","params","token","statSync","isFile","response","writeHead","size","readFileSync","write","end","error"],"mappings":";;;;;;;;;AAAA,IAAAA,EAAA;AAAAA,EAAA,GAAKC,GAAG,CAACC,OAAJ,CAAY,IAAZ,CAAL;AAEAC,MAAM,CAACC,GAAP,CAAW;AAGT,SAFA,KAACC,KAAD,CAAO,MAAP,EAAe;AACbC,QAAA,EAAM,cADO;AAEbC,SAAA,EAAO,QAFM;AAGbC,UAAA,EAAQ;AACN,UAAAC,QAAA,EAAAC,OAAA,EAAAC,CAAA,EAAAC,QAAA,EAAAC,KAAA;AAAAJ,cAAA,GAAW,KAACK,MAAD,CAAQC,KAAR,GAAgB,MAA3B;AACAH,cAAA,GAAW,SAAS,GAAT,GAAeH,QAA1B;;AACA;AACEI,aAAA,GAAQb,EAAE,CAACgB,QAAH,CAAYJ,QAAZ,CAAR;;AACA,YAAGC,KAAK,CAACI,MAAN,EAAH;AACE,eAACC,QAAD,CAAUC,SAAV,CAAoB,GAApB,EACE;AAAA,4BAAgB,0BAAhB;AACA,8BAAkBN,KAAK,CAACO,IADxB;AAEA,sBAAU,QAFV;AAGA,uBAAW,GAHX;AAIA,6BAAiB,4CAJjB;AAKA,mCAAuB,4BAA4BX,QAA5B,GAAuC,IAL9D;AAMA,yCAA6B;AAN7B,WADF;AAQAC,iBAAA,GAAUV,EAAE,CAACqB,YAAH,CAAgBT,QAAhB,CAAV;AACA,eAACM,QAAD,CAAUI,KAAV,CAAgBZ,OAAhB;AACA,eAACQ,QAAD,CAAUK,GAAV;AACA;AAdJ;AAAA,eAAAC,KAAA;AAeMb,SAAA,GAAAa,KAAA;AAOL;;AAND,WAACN,QAAD,CAAUC,SAAV,CAAoB,GAApB;AAQA,aAPA,KAACD,QAAD,CAAUK,GAAV,EAOA;AA3BM;AAHK,GAAf,CAEA;AAHF,G","file":"/server/routing.coffee","sourcesContent":["fs = Npm.require('fs')\n\nRouter.map ->\n  @route('dump', {\n    path: '/dump/:token',\n    where: 'server',\n    action: ->\n      basename = @params.token + \".rwf\"\n      filename = \"/tmp\" + \"/\" + basename\n      try\n        stats = fs.statSync(filename)\n        if stats.isFile()\n          @response.writeHead 200,\n            \"Content-Type\": \"application/octet-stream\"\n            \"Content-Length\": stats.size\n            \"Pragma\": \"public\"\n            \"Expires\": \"0\"\n            \"Cache-Control\": \"must-revalidate, post-check=0, pre-check=0\"\n            \"Content-Disposition\": \"attachment; filename=\\\"\" + basename + \"\\\"\"\n            \"Content-Transfer-Encoding\": \"binary\"\n          content = fs.readFileSync(filename)\n          @response.write(content)\n          @response.end()\n          return\n      catch e\n      @response.writeHead(404)\n      @response.end()\n  })\n"]}