{"version":3,"sources":["meteor://ðŸ’»app/server/security/configs.coffee"],"names":["share","Configs","allow","insert","securityRulesWrapper","userId","config","update","fieldNames","modifier","options","$set","Security","hasRole","Match","Error","isSSH","Optional","Boolean","host","String","port","user","identityFile","siteConfigFile","dataRootdir","dataTempdir","isNew","App","isNewUpdate","updatedAt","Date","isSetupComplete","_","extend","check","has","remove"],"mappings":";;;;;;;;;AAAAA,KAAK,CAACC,OAAN,CAAcC,KAAd,CACE;AAAAC,QAAA,EAAQH,KAAK,CAACI,oBAAN,CAA2B,UAACC,MAAD,EAASC,MAAT;AACjC,iBADiC;AAA3B,IAAR;AAEAC,QAAA,EAAQP,KAAK,CAACI,oBAAN,CAA2B,UAACC,MAAD,EAASC,MAAT,EAAiBE,UAAjB,EAA6BC,QAA7B,EAAuCC,OAAvC;AACjC,QAAAC,IAAA;;AAAA,SAAOX,KAAK,CAACY,QAAN,CAAeC,OAAf,CAAuBR,MAAvB,EAA+B,OAA/B,CAAP;AACE,YAAM,IAAIS,KAAK,CAACC,KAAV,CAAgB,sCAAhB,CAAN;AAGD;;AAFDJ,QAAA,GACE;AAAAK,WAAA,EAAOF,KAAK,CAACG,QAAN,CAAeC,OAAf,CAAP;AACAC,UAAA,EAAML,KAAK,CAACG,QAAN,CAAeG,MAAf,CADN;AAEAC,UAAA,EAAMP,KAAK,CAACG,QAAN,CAAeG,MAAf,CAFN;AAGAE,UAAA,EAAMR,KAAK,CAACG,QAAN,CAAeG,MAAf,CAHN;AAIAG,kBAAA,EAAcT,KAAK,CAACG,QAAN,CAAeG,MAAf,CAJd;AAKAI,oBAAA,EAAgBV,KAAK,CAACG,QAAN,CAAeG,MAAf,CALhB;AAMAK,iBAAA,EAAaX,KAAK,CAACG,QAAN,CAAeG,MAAf,CANb;AAOAM,iBAAA,EAAaZ,KAAK,CAACG,QAAN,CAAeG,MAAf,CAPb;AAQAO,WAAA,EAAOb,KAAK,CAACG,QAAN,CAAeH,KAAK,CAACc,GAAN,CAAUC,WAAV,CAAsBvB,MAAM,CAACqB,KAA7B,CAAf,CARP;AASAG,eAAA,EAAWC;AATX,KADF;;AAWA,QAAG,CAAIzB,MAAM,CAAC0B,eAAd;AACEC,OAAC,CAACC,MAAF,CAASvB,IAAT,EACE;AAAAqB,uBAAA,EAAiBlB,KAAK,CAACG,QAAN,CAAeC,OAAf;AAAjB,OADF;AAOD;;AAJDiB,SAAA,CAAM1B,QAAN,EACE;AAAAE,UAAA,EAAMA;AAAN,KADF;;AAGA,QAAGF,QAAQ,CAACE,IAAT,IAAkBsB,CAAC,CAACG,GAAF,CAAM3B,QAAQ,CAACE,IAAf,EAAqB,gBAArB,CAAlB,IAA6D,CAAIF,QAAQ,CAACE,IAAT,CAAca,cAAlF;AACE,YAAM,IAAIV,KAAK,CAACC,KAAV,CAAgB,yBAAhB,CAAN;AAMD;;AALD,QAAGN,QAAQ,CAACE,IAAT,IAAkBsB,CAAC,CAACG,GAAF,CAAM3B,QAAQ,CAACE,IAAf,EAAqB,aAArB,CAAlB,IAA0D,CAAIF,QAAQ,CAACE,IAAT,CAAcc,WAA/E;AACE,YAAM,IAAIX,KAAK,CAACC,KAAV,CAAgB,sBAAhB,CAAN;AAOD;;AAND,QAAGN,QAAQ,CAACE,IAAT,IAAkBsB,CAAC,CAACG,GAAF,CAAM3B,QAAQ,CAACE,IAAf,EAAqB,aAArB,CAAlB,IAA0D,CAAIF,QAAQ,CAACE,IAAT,CAAce,WAA/E;AACE,YAAM,IAAIZ,KAAK,CAACC,KAAV,CAAgB,sBAAhB,CAAN;AAQD;;AACD,WARA,IAQA;AAnCM,IAFR;AA8BAsB,QAAA,EAAQrC,KAAK,CAACI,oBAAN,CAA2B,UAACC,MAAD,EAASC,MAAT;AAUjC,WATA,KASA,CAViC;AAA3B;AA9BR,CADF,E","file":"/server/security/configs.coffee","sourcesContent":["share.Configs.allow\n  insert: share.securityRulesWrapper (userId, config) ->\n    false # There can be only one!\n  update: share.securityRulesWrapper (userId, config, fieldNames, modifier, options) ->\n    unless share.Security.hasRole(userId, \"admin\")\n      throw new Match.Error(\"Operation not allowed for non admins\")\n    $set =\n      isSSH: Match.Optional(Boolean)\n      host: Match.Optional(String)\n      port: Match.Optional(String)\n      user: Match.Optional(String)\n      identityFile: Match.Optional(String)\n      siteConfigFile: Match.Optional(String)\n      dataRootdir: Match.Optional(String)\n      dataTempdir: Match.Optional(String)\n      isNew: Match.Optional(Match.App.isNewUpdate(config.isNew))\n      updatedAt: Date\n    if not config.isSetupComplete\n      _.extend($set,\n        isSetupComplete: Match.Optional(Boolean)\n      )\n    check(modifier,\n      $set: $set\n    )\n    if modifier.$set and _.has(modifier.$set, \"siteConfigFile\") and not modifier.$set.siteConfigFile\n      throw new Match.Error(\"siteConfigFile required\")\n    if modifier.$set and _.has(modifier.$set, \"dataRootdir\") and not modifier.$set.dataRootdir\n      throw new Match.Error(\"dataRootdir required\")\n    if modifier.$set and _.has(modifier.$set, \"dataTempdir\") and not modifier.$set.dataTempdir\n      throw new Match.Error(\"dataTempdir required\")\n    true\n  remove: share.securityRulesWrapper (userId, config) ->\n    false # Who wants to live forever?\n"]}