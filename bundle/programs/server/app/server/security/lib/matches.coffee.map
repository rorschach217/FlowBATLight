{"version":3,"sources":["meteor://ðŸ’»app/server/security/lib/matches.coffee"],"names":["indexOf","Match","App","Id","Where","value","check","String","call","share","fixtureIds","length","_","difference","split","Error","UserId","Meteor","users","findOne","QueryId","Queries","IPSetId","IPSets","TupleId","Tuples","isNewUpdate","oldValue","Boolean","InArray","possibleValues","join","UnsignedNumber","Number","Email","match","emailRegex","extend","ExternalSource"],"mappings":"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","file":"/server/security/lib/matches.coffee","sourcesContent":["Match.App =\n  Id: Match.Where (value) ->\n    check(value, String)\n    if value in share.fixtureIds\n      return true # verbose IDs\n    if value.length isnt 17 or _.difference(value.split(\"\"), [\"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\", \"J\", \"K\", \"L\", \"M\", \"N\", \"P\", \"Q\", \"R\", \"S\", \"T\", \"W\", \"X\", \"Y\", \"Z\", \"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\"]).length\n      throw new Match.Error(\"Value \\\"\" + value + \"\\\" is not a valid ID\")\n    true\n  UserId: Match.Where (value) ->\n    check(value, Match.App.Id)\n    unless Meteor.users.findOne(value)\n      throw new Match.Error(\"User with ID \\\"\" + value + \"\\\" doesn't exist\")\n    true\n  QueryId: Match.Where (value) ->\n    check(value, Match.App.Id)\n    unless share.Queries.findOne(value)\n      throw new Match.Error(\"Query with ID \\\"\" + value + \"\\\" doesn't exist\")\n    true\n  IPSetId: Match.Where (value) ->\n    check(value, Match.App.Id)\n    unless share.IPSets.findOne(value)\n      throw new Match.Error(\"IP Set with ID \\\"\" + value + \"\\\" doesn't exist\")\n    true\n  TupleId: Match.Where (value) ->\n    check(value, Match.App.Id)\n    unless share.Tuples.findOne(value)\n      throw new Match.Error(\"Tuple file with ID \\\"\" + value + \"\\\" doesn't exist\")\n    true\n  isNewUpdate: (oldValue) ->\n    Match.Where (value) ->\n      check(value, Boolean)\n      if value and not oldValue\n        throw new Match.Error(\"isNew update can't be true from false\")\n      true\n  InArray: (possibleValues) ->\n    Match.Where (value) ->\n      if possibleValues.indexOf(value) == -1\n        throw new Match.Error(\"Expected one of \\\"\"+possibleValues.join(\"\\\", \\\"\")+\"\\\"; got \\\"\" + value + \"\\\"\")\n      true\n  UnsignedNumber: Match.Where (value) ->\n    check(value, Number)\n    if value < 0\n      throw new Match.Error(\"Must be unsigned number\")\n    true\n  Email: Match.Where (value) ->\n    value.match(share.emailRegex)\n_.extend(Match.App,\n  ExternalSource: Match.App.InArray([\"trello\"])\n)\n"]}