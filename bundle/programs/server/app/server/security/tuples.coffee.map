{"version":3,"sources":["meteor://ðŸ’»app/server/security/tuples.coffee"],"names":["share","Tuples","allow","insert","securityRulesWrapper","userId","tuple","Match","Error","_id","Random","id","ownerId","check","App","Id","name","String","note","contents","isOutputStale","Boolean","isNew","UserId","updatedAt","Date","createdAt","update","fieldNames","modifier","options","$set","Optional","isNewUpdate","_","has","remove"],"mappings":"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","file":"/server/security/tuples.coffee","sourcesContent":["share.Tuples.allow\n  insert: share.securityRulesWrapper (userId, tuple) ->\n    unless userId\n      throw new Match.Error(\"Operation not allowed for unauthorized users\")\n    tuple._id = tuple._id or Random.id()\n    tuple.ownerId = userId\n    check(tuple,\n      _id: Match.App.Id\n      name: String\n      note: String\n      contents: String\n      isOutputStale: Boolean\n      isNew: Boolean\n      ownerId: Match.App.UserId\n      updatedAt: Date\n      createdAt: Date\n    )\n    if not tuple.name\n      throw new Match.Error(\"Name required\")\n    if not tuple.contents\n      throw new Match.Error(\"Contents required\")\n    true\n  update: share.securityRulesWrapper (userId, tuple, fieldNames, modifier, options) ->\n    unless userId\n      throw new Match.Error(\"Operation not allowed for unauthorized users\")\n    unless userId is tuple.ownerId\n      throw new Match.Error(\"Operation not allowed for non-owners\")\n    $set =\n      name: Match.Optional(String)\n      note: Match.Optional(String)\n      contents: Match.Optional(String)\n      isOutputStale: Match.Optional(Boolean)\n      isNew: Match.Optional(Match.App.isNewUpdate(tuple.isNew))\n      updatedAt: Date\n    check(modifier,\n      $set: $set\n    )\n    if modifier.$set and _.has(modifier.$set, \"name\") and not modifier.$set.name\n      throw new Match.Error(\"Name required\")\n    if modifier.$set and _.has(modifier.$set, \"contents\") and not modifier.$set.contents\n      throw new Match.Error(\"Contents required\")\n    true\n  remove: share.securityRulesWrapper (userId, tuple) ->\n    unless userId\n      throw new Match.Error(\"Operation not allowed for unauthorized users\")\n    unless userId is tuple.ownerId\n      throw new Match.Error(\"Operation not allowed for non-owners\")\n    true\n"]}