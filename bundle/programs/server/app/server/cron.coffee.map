{"version":3,"sources":["meteor://ðŸ’»app/server/cron.coffee"],"names":["emailIntervalId","setIntervals","share","sendEmails","sendEmailsRunning","Meteor","_debug","Emails","find","forEach","email","to","match","Email","sendImmediate","remove","_id","seconds","settings","public","isDebug","setInterval","startup"],"mappings":";;;;;;;;;AAAA,IAAAA,eAAA,EAAAC,YAAA;;AAAAC,KAAK,CAACC,UAAN,GAAmB;AACjB,MAAGD,KAAK,CAACE,iBAAT;AACEC,UAAM,CAACC,MAAP,CAAc,sCAAd;;AACA;AAGD;;AAFDJ,OAAK,CAACE,iBAAN,GAA0B,IAA1B;;AACA;AAIE,WAHAF,KAAK,CAACK,MAAN,CAAaC,IAAb,GAAoBC,OAApB,CAA4B,UAACC,KAAD;AAC1B,UAAG,CAACA,KAAK,CAACC,EAAN,CAASC,KAAT,CAAe,eAAf,CAAJ;AAIE;AAFAC,aAAK,CAACC,aAAN,CAAoBJ,KAApB;AAID;;AACD,aAJAR,KAAK,CAACK,MAAN,CAAaQ,MAAb,CAAoBL,KAAK,CAACM,GAA1B,CAIA;AARF,MAGA;AAJF;AAOEd,SAAK,CAACE,iBAAN,GAA0B,KAA1B;AAMD;AAlBgB,CAAnB;;AAcAJ,eAAA,GAAkB,IAAlB;;AACAC,YAAA,GAAe;AACb,MAAAgB,OAAA;AAAAA,SAAA,GAAaZ,MAAM,CAACa,QAAP,CAAgBC,MAAhB,CAAuBC,OAAvB,GAAoC,CAApC,GAA2C,EAAxD;AAUA,SATApB,eAAA,GAAkBK,MAAM,CAACgB,WAAP,CAAmBnB,KAAK,CAACC,UAAzB,EAAqCc,OAAA,GAAU,IAA/C,CASlB;AAXa,CAAf;;AAIAZ,MAAM,CAACiB,OAAP,CAAe;AACb,MAAGjB,MAAM,CAACa,QAAP,CAAgBC,MAAhB,CAAuBC,OAA1B;AAaE;AACA,WAXAnB,YAAA,EAWA;AACD;AAhBH,G","file":"/server/cron.coffee","sourcesContent":["share.sendEmails = ->\n  if share.sendEmailsRunning\n    Meteor._debug(\"Send email already running; skipping\")\n    return\n  share.sendEmailsRunning = true\n  try\n    share.Emails.find().forEach (email) ->\n      if !email.to.match(/@flowbat.com$/)\n#        if Meteor.settings.public.isDebug then Meteor._debug('Sending \"'+email.subject+'\" to \"'+email.to+'\"')\n        Email.sendImmediate(email)\n      share.Emails.remove(email._id)\n  finally\n    share.sendEmailsRunning = false\n\nemailIntervalId = null\nsetIntervals = ->\n  seconds = if Meteor.settings.public.isDebug then 5 else 60\n  emailIntervalId = Meteor.setInterval(share.sendEmails, seconds * 1000)\n\nMeteor.startup ->\n  if Meteor.settings.public.isDebug\n#    setIntervals()\n  else\n    setIntervals()\n\n"]}